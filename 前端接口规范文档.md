# 前端接口规范文档

## 🎯 设计大纲
- 设计原则 - 前端专注渲染、避免多接口嵌套等核心原则
- URL设计 - RESTful API设计规范和HTTP方法使用
- 请求格式 - 请求头、请求体、查询参数的规范
- 响应格式 - 统一的响应结构和不同数据类型的处理
- 状态码规范 - HTTP状态码和业务状态码的使用
- 字段规范 - 命名规则和数据类型处理
- 接口实践 - 创建、查询、更新、删除接口的具体示例
- 文件上传 - 单文件和多文件上传的处理
- 特殊场景 - 下拉选项、图表数据等特殊接口
- 错误处理 - 完整的错误分类和处理机制
- 安全规范 - 认证授权和敏感数据处理
- 性能优化 - 分页、缓存、压缩等优化建议
- 文档维护 - 文档编写和维护的要求
- 总结 - 规范的价值和使用建议


## 1. 设计原则与基础约定

### 1.1 核心设计原则
- **渲染与数据分离**：前端聚焦视图渲染，接口返回数据应直接满足展示需求，减少前端二次加工
- **数据聚合返回**：单个功能所需数据通过单次接口请求获取，避免多接口嵌套调用
- **格式标准化**：统一采用 JSON 响应格式，简化数据结构，避免过深嵌套
- **实时通信优先**：实时数据通过 WebSocket 等推送机制传输，替代前端轮询，降低资源消耗

### 1.1.1 扩展设计原则
- 数据完整性原则​
    - 接口返回数据应包含所有必要字段，避免前端因缺失数据导致渲染异常。例如：列表接口需同时返回总数、分页信息和列表项，而非分次请求。​
- 字段命名一致性​
    - 采用统一的命名规范（如驼峰式userName），避免同一概念使用不同字段名（如同时出现userId和user_id）。​
- 版本兼容原则​
    - 接口变更需保证向后兼容，新增字段不影响旧版本功能。如需删除字段，应通过版本号（如/v2/api）区分。​
- 错误处理标准化​
    - 错误响应格式统一，包含错误码、描述信息和解决方案（如{"code":400,"message":"参数错误","solution":"请检查手机号格式"}）。​
- 幂等性设计​
    - 重复调用同一接口（如提交表单）不会产生副作用，通过唯一标识（如requestId）确保操作唯一性。​
- 数据类型明确性​
    - 字段类型保持稳定（如createTime始终为时间戳或 ISO 格式字符串），避免同一字段时而返回数字、时而返回字符串。​
- 分页参数统一​
    - 分页接口采用标准化参数（pageNum+pageSize或offset+limit），并在响应中明确总页数和当前页位置。​
- 权限与认证统一​
    - 认证信息（如 Token）通过请求头传递，权限不足时返回一致的 403 状态码，避免不同接口采用不同认证方式。​
- 冗余字段最小化​
    - 避免返回无关数据（如列表接口返回详情页才需要的大文本字段），减少传输体积。​
- 文档化与可测试性​
    - 接口需提供完整文档（如 Swagger），包含参数说明、返回示例和错误码列表，并支持在线调试。​
- 缓存策略明确​
    - 对静态数据（如字典表）明确缓存机制（如Cache-Control头），减少重复请求。​
- 批量操作支持​
    - 提供批量接口（如/api/users/batch），支持批量新增、修改或删除，减少请求次数。​
- 数据脱敏原则​
    - 敏感信息（如手机号、身份证号）在接口返回时进行脱敏处理（如138****5678），降低信息泄露风险。​
- 接口职责单一性​
    - 一个接口专注于单一功能（如/api/user负责用户信息，/api/order负责订单管理），避免 "万能接口"。​
- 性能适配原则​
    - 大体积数据（如图片列表）支持分页加载或懒加载，通过参数（如size=small）控制返回数据精度。​

### 1.2 基础约定

#### 1.2.1 协议规范
- **统一使用HTTPS协议**对外提供服务
- **内部服务可使用HTTP**，由网关或Nginx转换为HTTPS

#### 1.2.2 域名规范
- **推荐使用专用API域名**：`https://api.example.com`
- **简单API可使用子路径**：`https://example.com/api/`

#### 1.2.3 版本管理
- **URL中包含版本号**：`/api/v1/users`
- **版本号格式**：使用v1、v2等形式
- **向下兼容**：新版本应保持向下兼容性

**示例：**
```
正确：https://api.example.com/v1/users
错误：https://api.example.com/users
```

## 2. URL设计规范

### 2.1 路径命名规则

#### 2.1.1 基本规则
- **使用名词而非动词**：URL中只能包含名词，动作由HTTP方法体现
- **统一使用复数形式**：所有资源名称使用复数
- **小写字母**：全部使用小写字母
- **连字符分隔**：使用连字符`-`代替下划线`_`

**示例：**
```
正确：/api/v1/user-profiles
错误：/api/v1/userProfiles
错误：/api/v1/user_profiles
错误：/api/v1/getUserProfile
```

#### 2.1.2 资源层级关系
- **合理嵌套**：体现资源之间的层级关系
- **避免过深嵌套**：一般不超过3层

**示例：**
```
正确：/api/v1/users/123/orders
正确：/api/v1/departments/456/users/123/orders
错误：/api/v1/companies/1/departments/2/teams/3/users/4/orders/5/items
```

### 2.2 HTTP方法规范

#### 2.2.1 标准HTTP方法
| 方法 | 用途 | 说明 |
|------|------|------|
| GET | 获取资源 | 幂等操作，不产生副作用 |
| POST | 创建资源 | 非幂等操作 |
| PUT | 全量更新资源 | 幂等操作，提供完整资源 |
| PATCH | 部分更新资源 | 幂等操作，提供部分字段 |
| DELETE | 删除资源 | 幂等操作 |

#### 2.2.2 RESTful API设计示例
```
GET    /api/v1/users           # 获取用户列表
POST   /api/v1/users           # 创建新用户
GET    /api/v1/users/123       # 获取指定用户
PUT    /api/v1/users/123       # 全量更新用户
PATCH  /api/v1/users/123       # 部分更新用户
DELETE /api/v1/users/123       # 删除用户
GET    /api/v1/users/123/orders # 获取用户的订单列表
```

## 3. 请求格式规范

### 3.1 请求头规范

#### 3.1.1 必需请求头
```http
Content-Type: application/json
Accept: application/json
Authorization: Bearer {token}
```

#### 3.1.2 可选请求头
```http
X-Request-ID: uuid-string      # 请求追踪ID
User-Agent: AppName/1.0.0      # 客户端信息
Accept-Language: zh-CN,zh;q=0.9 # 语言偏好
```

### 3.2 请求体规范

#### 3.2.1 JSON格式要求
- **统一使用JSON格式**
- **字段命名采用小驼峰**：`userName`、`userId`
- **避免嵌套过深**：一般不超过3层：现实业务

**示例：**
```json
{
  "userName": "张三",
  "email": "zhangsan@example.com",
  "profile": {
    "age": 25,
    "address": {
      "province": "广东省",
      "city": "深圳市"
    }
  }
}
```

### 3.3 查询参数规范

#### 3.3.1 分页参数
```
GET /api/v1/users?page=1&size=20
```
- `page`：页码，从1开始
- `size`：每页数量，默认20

#### 3.3.2 排序参数
```
GET /api/v1/users?sort=createTime&order=desc
```
- `sort`：排序字段
- `order`：排序方向（asc/desc）

#### 3.3.3 筛选参数
```
GET /api/v1/users?status=active&keyword=张三&createTime_gte=2023-01-01
```
- **等值筛选**：`status=active`
- **模糊查询**：`keyword=张三`
- **范围查询**：`createTime_gte=2023-01-01`（大于等于）
- **多值筛选**：`status=active,inactive`

## 4. 响应格式规范

### 4.1 统一响应结构

#### 4.1.1 基础响应格式
```json
{
  "code": 200,
  "msg": "success",
  "data": null,
}
```

**字段说明：**
- `code`：业务状态码，数值类型，0表示成功，非0表示失败
- `msg`：提示信息，用户友好的描述
- `data`：实际业务数据

#### 4.1.2 成功响应示例
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "userId": 123,
    "userName": "张三",
    "email": "zhangsan@example.com",
    "createTime": "2023-12-01T10:00:00+08:00"
  },
}
```

### 4.2 不同数据类型的响应格式

#### 4.2.1 单个对象响应
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "id": 123,
    "name": "张三",
    "status": "active"
  }
}
```

#### 4.2.2 列表响应
```json
{
  "code": 0,
  "msg": "success",
  "data": [
    {
      "id": 1,
      "name": "张三"
    },
    {
      "id": 2,
      "name": "李四"
    }
  ]
}
```

#### 4.2.3 分页响应
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "name": "张三"
      },
      {
        "id": 2,
        "name": "李四"
      }
    ],
    "page": {
        "pageNum": 1,
        "pageSize": 20,
        "total": 100,
        "totalPages": 5
    }
  }
}
```

### 4.3 错误响应格式

#### 4.3.1 业务错误响应
```json
{
  "code": 1001,
  "msg": "用户名已存在",
  "data": null,
}
```

#### 4.3.2 列表错误响应
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "list": [],
    "page": {
        "pageNum": 1,
        "pageSize": 0,
        "total": 0,
        "totalPages": 0
    }
  }
}
```

#### 4.3.3 参数验证错误响应
```json
{
  "code": 400,
  "msg": "参数验证失败",
  "data": {
    "errors": [
      {
        "field": "userName",
        "message": "用户名不能为空"
      },
      {
        "field": "email",
        "message": "邮箱格式不正确"
      }
    ]
  },
}
```

## 5. 状态码规范

### 5.1 HTTP状态码
| 状态码 | 含义 | 使用场景 |
|--------|------|----------|
| 200 | 成功 | GET、PUT、PATCH成功 |
| 201 | 创建成功 | POST成功创建资源 |
| 204 | 无内容 | DELETE成功 |
| 400 | 请求错误 | 参数验证失败 |
| 401 | 未认证 | 未登录或token失效 |
| 403 | 禁止访问 | 权限不足 |
| 404 | 资源不存在 | 请求的资源不存在 |
| 500 | 服务器错误 | 服务器内部错误 |

### 5.2 业务状态码
| code | 含义 | 说明 |
|------|------|------|
| 0 | 成功 | 业务处理成功 |
| 1 | 通用失败 | 业务处理失败 |
| 400 | 参数错误 | 请求参数不正确 |
| 401 | 未登录 | 需要登录 |
| 403 | 无权限 | 权限不足 |
| 404 | 资源不存在 | 请求的资源不存在 |
| 500 | 服务器错误 | 服务器内部错误 |
| 1001+ | 业务自定义错误 | 具体业务错误码 |

## 6. 字段规范

### 6.1 命名规范

#### 6.1.1 字段命名规则
- **小驼峰命名**：`userId`、`userName`、`createTime`
- **布尔值命名**：使用`is`、`has`前缀，如`isActive`、`hasPermission`
- **时间字段命名**：使用`Time`后缀，如`createTime`、`updateTime`

#### 6.1.2 常用字段约定
| 字段名 | 含义 | 类型 | 示例 |
|--------|------|------|------|
| id | 主键ID | number/string | 123 |
| name | 名称 | string | "张三" |
| status | 状态 | string | "active" |
| createTime | 创建时间 | string | "2023-12-01T10:00:00+08:00" |
| updateTime | 更新时间 | string | "2023-12-01T10:00:00+08:00" |
| isDeleted | 是否删除 | boolean | false |

### 6.2 数据类型规范

#### 6.2.1 基本数据类型
- **字符串**：使用双引号包围
- **数字**：整数或浮点数，不使用引号
- **布尔值**：true/false
- **数组**：使用方括号，空数组返回`[]`而非`null`
- **对象**：使用花括号，空对象返回`{}`而非`null`

#### 6.2.2 特殊数据类型处理

**时间格式：**
```json
{
  "createTime": "2023-12-01T10:00:00+08:00"
  "createTime": "1752116872337
}
```

**金额格式：**
```json
{
  "amount": 10000,
  "amountUnit": "分"
}
```

**枚举值：**
```json
{
  "status": "active",
  "statusText": "激活"
}
```

## 7. 接口设计最佳实践

### 7.1 创建类接口

#### 7.1.1 用户创建接口
**请求：**
```http
POST /api/v1/users
Content-Type: application/json

{
  "userName": "张三",
  "email": "zhangsan@example.com",
  "password": "123456",
  "roleIds": [1, 2, 3]
}
```

**响应：**
```json
{
  "code": 0,
  "msg": "创建成功",
  "data": {
    "userId": 123
  },
}
```

#### 7.1.2 订单创建接口
**请求：**
```http
POST /api/v1/orders
Content-Type: application/json

{
  "userId": 123,
  "productId": 456,
  "quantity": 2,
  "amount": 10000,
  "address": {
    "province": "广东省",
    "city": "深圳市",
    "detail": "南山区科技园"
  }
}
```

**响应：**
```json
{
  "code": 0,
  "msg": "订单创建成功",
  "data": {
    "orderId": "ORD202312010001",
    "status": "pending",
    "createTime": "2023-12-01T10:00:00+08:00"
  }
}
```

### 7.2 查询类接口

#### 7.2.1 用户列表查询
**请求：**
```http
GET /api/v1/users?page=1&size=20&status=active&keyword=张三&sort=createTime&order=desc
```

**响应：**
```json
{
  "code": 0,
  "msg": "查询成功",
  "data": {
    "list": [
      {
        "userId": 123,
        "userName": "张三",
        "email": "zhangsan@example.com",
        "status": "active",
        "statusText": "激活",
        "roles": [
          {
            "roleId": 1,
            "roleName": "管理员"
          },
          {
            "roleId": 2,
            "roleName": "普通用户"
          }
        ],
        "createTime": "2023-12-01T10:00:00+08:00",
        "updateTime": "2023-12-01T10:00:00+08:00"
      }
    ],
    "page": {
        "pageNum": 1,
        "pageSize": 20,
        "total": 100,
        "totalPages": 5
    }
  }
}
```

#### 7.2.2 用户详情查询
**请求：**
```http
GET /api/v1/users/123
```

**响应：**
```json
{
  "code": 0,
  "msg": "查询成功",
  "data": {
    "userId": 123,
    "userName": "张三",
    "email": "zhangsan@example.com",
    "phone": "13800138000",
    "status": "active",
    "statusText": "激活",
    "profile": {
      "age": 25,
      "gender": "male",
      "genderText": "男",
      "avatar": "https://cdn.example.com/avatars/123.jpg",
      "address": {
        "province": "广东省",
        "city": "深圳市",
        "detail": "南山区科技园"
      }
    },
    "roles": [
      {
        "roleId": 1,
        "roleName": "管理员",
        "permissions": [
          {
            "permissionId": 1,
            "permissionName": "用户管理"
          }
        ]
      }
    ],
    "createTime": "2023-12-01T10:00:00+08:00",
    "updateTime": "2023-12-01T10:00:00+08:00"
  }
}
```

### 7.3 更新类接口

#### 7.3.1 用户信息更新
**请求：**
```http
PATCH /api/v1/users/123
Content-Type: application/json

{
  "userName": "张三三",
  "phone": "13800138001",
  "profile": {
    "age": 26
  }
}
```

**响应：**
```json
{
  "code": 0,
  "msg": "更新成功",
  "data": {
    "userId": 123,
    "userName": "张三三",
    "phone": "13800138001",
    "updateTime": "2023-12-01T11:00:00+08:00"
  }
}
```

### 7.4 删除类接口

#### 7.4.1 单个删除
**请求：**
```http
DELETE /api/v1/users/123
```

**响应：**
```json
{
  "code": 0,
  "msg": "删除成功",
  "data": null
}
```

#### 7.4.2 批量删除
**请求：**
```http
DELETE /api/v1/users?ids=123,124,125
```

**响应：**
```json
{
  "code": 0,
  "msg": "批量删除成功",
  "data": {
    "deletedCount": 3,
    "failedIds": []
  }
}
```

## 8. 文件上传接口规范

### 8.1 单文件上传

#### 8.1.1 文件上传接口
**请求：**
```http
POST /api/v1/files
Content-Type: multipart/form-data

file: [File对象]
```

**响应：**
```json
{
  "code": 0,
  "msg": "上传成功",
  "data": {
    "fileId": "file_123456",
    "fileName": "document.pdf",
    "fileSize": 1024000,
    "fileType": "application/pdf",
    "fileUrl": "https://cdn.example.com/files/file_123456.pdf",
    "uploadTime": "2023-12-01T10:00:00+08:00"
  }
}
```

### 8.2 多文件上传

#### 8.2.1 多文件上传接口
**请求：**
```http
POST /api/v1/files/batch
Content-Type: multipart/form-data

files: [File对象数组]
```

**响应：**
```json
{
  "code": 0,
  "msg": "批量上传成功",
  "data": [
    {
      "fileId": "file_123456",
      "fileName": "document1.pdf",
      "fileUrl": "https://cdn.example.com/files/file_123456.pdf"
    },
    {
      "fileId": "file_123457",
      "fileName": "document2.pdf",
      "fileUrl": "https://cdn.example.com/files/file_123457.pdf"
    }
  ]
}
```

## 9. 特殊场景接口规范

### 9.1 下拉选项接口

#### 9.1.1 角色选项接口
**请求：**
```http
GET /api/v1/roles/options
```

**响应：**
```json
{
  "code": 0,
  "msg": "查询成功",
  "data": [
    {
      "value": 1,
      "label": "管理员",
      "disabled": false
    },
    {
      "value": 2,
      "label": "普通用户",
      "disabled": false
    },
    {
      "value": 3,
      "label": "访客",
      "disabled": true
    }
  ]
}
```

### 9.2 图表数据接口

#### 9.2.1 用户增长趋势
**请求：**
```http
GET /api/v1/statistics/user-growth?startDate=2023-11-01&endDate=2023-11-30
```

**响应：**
```json
{
  "code": 0,
  "msg": "查询成功",
  "data": {
    "xAxis": ["2023-11-01", "2023-11-02", "2023-11-03"],
    "series": [
      {
        "name": "新增用户",
        "data": [120, 150, 180],
        "color": "#1890ff"
      },
      {
        "name": "活跃用户",
        "data": [800, 850, 900],
        "color": "#52c41a"
      }
    ]
  }
}
```

#### 9.2.2 用户分布饼图
**请求：**
```http
GET /api/v1/statistics/user-distribution
```

**响应：**
```json
{
  "code": 0,
  "msg": "查询成功",
  "data": {
    "series": [
      {
        "name": "管理员",
        "value": 50,
        "color": "#1890ff"
      },
      {
        "name": "普通用户",
        "value": 800,
        "color": "#52c41a"
      },
      {
        "name": "访客",
        "value": 150,
        "color": "#faad14"
      }
    ]
  }
}
```

## 10. 错误处理规范

### 10.1 错误分类

#### 10.1.1 客户端错误（4xx）
- **400 Bad Request**：请求参数错误
- **401 Unauthorized**：未认证
- **403 Forbidden**：权限不足
- **404 Not Found**：资源不存在
- **422 Unprocessable Entity**：数据验证失败

#### 10.1.2 服务器错误（5xx）
- **500 Internal Server Error**：服务器内部错误
- **502 Bad Gateway**：网关错误
- **503 Service Unavailable**：服务不可用

### 10.2 错误响应示例

#### 10.2.1 参数验证错误
```json
{
  "code": 400,
  "msg": "参数验证失败",
  "data": {
    "errors": [
      {
        "field": "userName",
        "message": "用户名长度必须在2-20个字符之间",
        "code": "INVALID_LENGTH"
      },
      {
        "field": "email",
        "message": "邮箱格式不正确",
        "code": "INVALID_FORMAT"
      }
    ]
  },
}
```

#### 10.2.2 业务逻辑错误
```json
{
  "code": 1001,
  "msg": "用户名已存在，请选择其他用户名",
  "data": null,
}
```

## 11. 安全规范

### 11.1 认证与授权

#### 11.1.1 JWT Token认证
**请求头：**
```http
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

#### 11.1.2 Token刷新接口
**请求：**
```http
POST /api/v1/auth/refresh
Content-Type: application/json

{
  "refreshToken": "refresh_token_string"
}
```

**响应：**
```json
{
  "code": 0,
  "msg": "刷新成功",
  "data": {
    "accessToken": "new_access_token",
    "refreshToken": "new_refresh_token",
    "expiresIn": 3600
  }
}
```

### 11.2 敏感数据处理

#### 11.2.1 密码字段
```json
{
  "userId": 123,
  "userName": "张三",
  "password": "U2FsdGVkX1+1fW7OpO/tlPXe4IGA/bXExlhKwIR/spk="
}
```

#### 11.2.2 身份证号脱敏
```json
{
  "userId": 123,
  "userName": "张三",
  "idCard": "320***********1234"
}
```

## 12. 性能优化建议

### 12.1 分页优化
- **合理设置默认分页大小**：建议20-50条
- **限制最大分页大小**：避免单次查询过多数据
- **提供总数统计开关**：大数据量时可关闭总数统计

### 12.2 缓存策略
- **合理设置缓存头**：`Cache-Control`、`ETag`等
- **支持条件请求**：`If-None-Match`、`If-Modified-Since`

### 12.3 数据压缩
- **启用GZIP压缩**：减少传输数据量
- **字段按需返回**：支持字段过滤参数

## 13. 文档维护规范

### 13.1 接口文档要求
- **完整的接口描述**：包含功能说明、参数说明、返回值说明
- **详细的示例**：提供完整的请求和响应示例
- **错误码说明**：列出所有可能的错误码及其含义
- **版本变更记录**：记录每个版本的变更内容

### 13.2 文档工具推荐
- **Swagger/OpenAPI**：自动生成接口文档
- **Postman**：接口测试和文档生成
- **Apifox**：接口设计、测试、文档一体化工具

## 14. 总结

本文档制定了完整的前端接口规范，包括：
- 统一的请求响应格式
- 规范的URL设计
- 完整的错误处理机制
- 详细的接口示例
- 安全性考虑
- 性能优化建议

遵循这些规范可以：
- 提高前后端协作效率
- 减少接口对接时间
- 提升用户体验
- 便于接口维护和扩展



# 问题： 
1.code返回值问题
2.时间问题
